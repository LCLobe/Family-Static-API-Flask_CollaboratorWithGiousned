from flask import jsonify, url_for

class APIException(Exception):
    status_code = 400

    def __init__(self, message, status_code=None, payload=None):
        Exception.__init__(self)
        self.message = message
        if status_code is not None:
            self.status_code = status_code
        self.payload = payload

    def to_dict(self):
        rv = dict(self.payload or ())
        rv['message'] = self.message
        return rv

def has_no_empty_params(rule):
    defaults = rule.defaults if rule.defaults is not None else ()
    arguments = rule.arguments if rule.arguments is not None else ()
    return len(defaults) >= len(arguments)

def generate_sitemap(app):
    links = []
    for rule in app.url_map.iter_rules():
        # Filter out rules we can't navigate to in a browser
        # and rules that require parameters
        if "GET" in rule.methods and has_no_empty_params(rule):
            url = url_for(rule.endpoint, **(rule.defaults or {}))
            links.append(url)

    links_html = "".join(["<li><a href='" + y + "'>" + y + "</a></li>" for y in links])
    return """
        <div style="text-align: center;">
        <img src='data:image/png;base64,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' />
        <h1>Welcome to the family!!</h1>
        This is our api home, remember to specify a real endpoint path like: <ul style="text-align: left;">"""+links_html+"</ul></div>"
